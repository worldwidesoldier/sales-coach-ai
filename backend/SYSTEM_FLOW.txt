================================================================================
COACHING SYSTEM DATA FLOW
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SALES COACH AI - BACKEND FLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


1. TRANSCRIPTION EVENT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    Frontend                                          Backend
    --------                                          -------

    ğŸ¤ Audio
       â”‚
       â””â”€â”€audio_streamâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
                                                      â”‚
                                              Deepgram Service
                                                      â”‚
       â”Œâ”€â”€transcriptionâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—„â”€â”˜
       â”‚
    ğŸ“ Transcript Received
       â”‚
       â””â”€â”€(stored in UI)


2. COACHING GUIDANCE REQUEST (COACHING_MODE=guidance)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    app.py                          claude_service.py                Config
    ------                          -----------------                ------

    handle_transcript()
         â”‚
         â”‚ if is_final:
         â”œâ”€â”€â–º conversation_manager.add_message()
         â”‚
         â””â”€â”€â–º get_ai_suggestion(session_id, client_id)
                      â”‚
                      â”œâ”€â–º context = conversation_manager.get_context()
                      â”‚
                      â”œâ”€â–º coaching_mode = Config.COACHING_MODE â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                                                   â”‚
                      â”‚                                              .env file
                      â”‚                                         COACHING_MODE
                      â”‚
                      â””â”€â–º if coaching_mode == 'guidance':
                              â”‚
                              â””â”€â”€â–º get_coaching_guidance(context)
                                       â”‚
                                       â”œâ”€â–º _detect_call_stage() â—„â”€â”€â”
                                       â”‚        â”‚                   â”‚
                                       â”‚        â”‚   [Keyword Analysis]
                                       â”‚        â”‚   - opening keywords
                                       â”‚        â”‚   - discovery keywords
                                       â”‚        â”‚   - pitch keywords
                                       â”‚        â”‚   - objection keywords
                                       â”‚        â”‚   - close keywords
                                       â”‚        â”‚
                                       â”‚        â”‚   [Natural Progression]
                                       â”‚        â”‚   - boost next stages
                                       â”‚        â”‚
                                       â”‚        â””â”€â”€â–º detected_stage
                                       â”‚                 â”‚
                                       â”‚                 â”‚ confidence: 85%
                                       â”‚                 â”‚ stage: "discovery"
                                       â”‚
                                       â”œâ”€â–º _track_objectives() â—„â”€â”€â”€â”€â”€â”€â”
                                       â”‚        â”‚                      â”‚
                                       â”‚        â”‚           CALL_OBJECTIVES
                                       â”‚        â”‚           [discovery]:
                                       â”‚        â”‚           - qualify_volume
                                       â”‚        â”‚           - identify_pain
                                       â”‚        â”‚           - current_solution
                                       â”‚        â”‚
                                       â”‚        â”‚   [Keyword Matching]
                                       â”‚        â”‚   - scan conversation
                                       â”‚        â”‚   - mark completed
                                       â”‚        â”‚
                                       â”‚        â””â”€â”€â–º objectives
                                       â”‚                 â”‚
                                       â”‚                 â”‚ completed: [...]
                                       â”‚                 â”‚ remaining: [...]
                                       â”‚
                                       â”œâ”€â–º _format_conversation_for_coaching()
                                       â”‚        â”‚
                                       â”‚        â””â”€â”€â–º "Speaker: text\n..."
                                       â”‚
                                       â”œâ”€â–º Claude API Call
                                       â”‚        â”‚
                                       â”‚        â”‚ COACHING_SYSTEM_PROMPT:
                                       â”‚        â”‚ "You are a real-time coach
                                       â”‚        â”‚  providing STRATEGIC guidance
                                       â”‚        â”‚  (NOT exact scripts)..."
                                       â”‚        â”‚
                                       â”‚        â””â”€â”€â–º JSON response
                                       â”‚                 â”‚
                                       â”‚                 â”‚ stage_validation
                                       â”‚                 â”‚ focus
                                       â”‚                 â”‚ key_questions
                                       â”‚                 â”‚ talking_points
                                       â”‚                 â”‚ objectives
                                       â”‚
                                       â”œâ”€â–º _parse_coaching_response()
                                       â”‚        â”‚
                                       â”‚        â””â”€â”€â–º validated JSON
                                       â”‚
                                       â””â”€â–º Build guidance object
                                                â”‚
                                                â””â”€â”€â–º return guidance


3. DUAL EVENT EMISSION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    app.py                                            Frontend
    ------                                            --------

    get_ai_suggestion()
         â”‚
         â”œâ”€â”€â–º guidance['metadata']['session_id'] = session_id
         â”‚
         â”œâ”€â”€â–º socketio.emit('coaching_guidance', guidance)
         â”‚                                          â”‚
         â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
         â”‚                                                           â”‚
         â”‚                                                    socket.on('coaching_guidance')
         â”‚                                                           â”‚
         â”œâ”€â”€â–º legacy_suggestion = convert_guidance_to_suggestion()  â”‚
         â”‚           â”‚                                               â”‚
         â”‚           â”‚  [Convert to legacy format]:                 â”‚
         â”‚           â”‚  primary_suggestion                          â”‚
         â”‚           â”‚  context                                     â”‚
         â”‚           â”‚  highlight_toolkit                           â”‚
         â”‚           â”‚  next_move                                   â”‚
         â”‚           â”‚                                               â”‚
         â””â”€â”€â–º socketio.emit('suggestion', legacy_suggestion)        â”‚
                                                     â”‚               â”‚
                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
                                                                     â”‚
                                                              socket.on('suggestion')
                                                                     â”‚
                                                              [Backward Compatible]


4. FALLBACK ON ERROR
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    claude_service.py
    -----------------

    get_coaching_guidance()
         â”‚
         â”‚ try:
         â”‚    â””â”€â–º Claude API call
         â”‚
         â”‚ except Exception as e:
         â”‚    â”‚
         â”‚    â”œâ”€â–º logger.error("Error getting coaching guidance")
         â”‚    â”‚
         â”‚    â””â”€â–º _get_fallback_guidance(detected_stage)
         â”‚              â”‚
         â”‚              â”‚  [Generic guidance by stage]:
         â”‚              â”‚
         â”‚              â”‚  opening:
         â”‚              â”‚    - direction: "Build rapport..."
         â”‚              â”‚    - questions: ["How are you?", ...]
         â”‚              â”‚
         â”‚              â”‚  discovery:
         â”‚              â”‚    - direction: "Understand pain points..."
         â”‚              â”‚    - questions: ["What's your process?", ...]
         â”‚              â”‚
         â”‚              â”‚  pitch:
         â”‚              â”‚    - direction: "Present solution..."
         â”‚              â”‚    - questions: ["Would it help if...?", ...]
         â”‚              â”‚
         â”‚              â”‚  objection:
         â”‚              â”‚    - direction: "Acknowledge concern..."
         â”‚              â”‚    - questions: ["What's your main concern?", ...]
         â”‚              â”‚
         â”‚              â”‚  close:
         â”‚              â”‚    - direction: "Propose next step..."
         â”‚              â”‚    - questions: ["Want to try it?", ...]
         â”‚              â”‚
         â”‚              â””â”€â”€â–º return fallback_guidance
         â”‚                        â”‚
         â”‚                        â””â”€â–º [Safe default, no crash]


5. FEATURE FLAG CHECK
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    Frontend                    Backend                     Config
    --------                    -------                     ------

    GET /api/feature-flags
         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
                                â”‚ get_feature_flags()
                                â”‚      â”‚
                                â”‚      â”œâ”€â–º Config.COACHING_MODE â—„â”€â”€â”€â”
                                â”‚      â”‚                             â”‚
                                â”‚      â””â”€â–º return {              .env file
                                â”‚              "coaching_mode",  COACHING_MODE
                                â”‚              "guidance_version"     â”‚
                                â”‚           }                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—„â”€â”˜                                    â”‚
         â”‚                                                            â”‚
    {                                                                 â”‚
      "coaching_mode": "suggestions",                                â”‚
      "guidance_version": "v1"                                       â”‚
    }                                                                 â”‚
         â”‚                                                            â”‚
    [Update UI based on mode] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
DATA STRUCTURES
================================================================================

COACHING GUIDANCE OBJECT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                                                           â”‚
â”‚   "type": "coaching_guidance",                                              â”‚
â”‚   "stage": {                                                                â”‚
â”‚     "current": "discovery",              â—„â”€ Detected stage                 â”‚
â”‚     "confidence": 85,                    â—„â”€ Detection confidence (0-100)   â”‚
â”‚     "time_in_stage": 0                   â—„â”€ Seconds in this stage          â”‚
â”‚   },                                                                        â”‚
â”‚   "focus": {                                                                â”‚
â”‚     "what": "Understand pain points",    â—„â”€ What to achieve NOW            â”‚
â”‚     "why": "Need to qualify...",         â—„â”€ Strategic reasoning            â”‚
â”‚     "urgency": "medium"                  â—„â”€ Priority level                 â”‚
â”‚   },                                                                        â”‚
â”‚   "objectives": {                                                           â”‚
â”‚     "completed": [                       â—„â”€ What's been accomplished        â”‚
â”‚       {"id": "rapport", "text": "Build rapport"}                           â”‚
â”‚     ],                                                                      â”‚
â”‚     "remaining": [                       â—„â”€ What's still needed             â”‚
â”‚       {"id": "identify_pain", "text": "Identify pain", "priority": "high"} â”‚
â”‚     ]                                                                       â”‚
â”‚   },                                                                        â”‚
â”‚   "guidance": {                                                             â”‚
â”‚     "direction": "Full strategic text",  â—„â”€ What + Why combined            â”‚
â”‚     "key_questions": [                   â—„â”€ Questions to ask                â”‚
â”‚       "What's your current process?",                                       â”‚
â”‚       "What challenges are you facing?",                                    â”‚
â”‚       "How many calls per week?"                                            â”‚
â”‚     ],                                                                      â”‚
â”‚     "talking_points": [                  â—„â”€ Points to emphasize             â”‚
â”‚       "Listen actively",                                                    â”‚
â”‚       "Ask open-ended questions"                                            â”‚
â”‚     ],                                                                      â”‚
â”‚     "confidence": 85                     â—„â”€ Overall confidence              â”‚
â”‚   },                                                                        â”‚
â”‚   "metadata": {                                                             â”‚
â”‚     "timestamp": 1701234567,             â—„â”€ Unix timestamp                 â”‚
â”‚     "session_id": "call_xyz",            â—„â”€ Current call session           â”‚
â”‚     "model_version": "coaching_v1"       â—„â”€ Model version                  â”‚
â”‚   }                                                                         â”‚
â”‚ }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CALL OBJECTIVES (per stage):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "discovery": [                                                              â”‚
â”‚   {                                                                         â”‚
â”‚     "id": "qualify_volume",              â—„â”€ Unique identifier              â”‚
â”‚     "text": "Qualify call volume",       â—„â”€ Human-readable description     â”‚
â”‚     "keywords": [                        â—„â”€ Detection keywords              â”‚
â”‚       "how many calls",                                                     â”‚
â”‚       "volume",                                                             â”‚
â”‚       "receive",                                                            â”‚
â”‚       "per day",                                                            â”‚
â”‚       "per week"                                                            â”‚
â”‚     ]                                                                       â”‚
â”‚   },                                                                        â”‚
â”‚   { ... more objectives ... }                                               â”‚
â”‚ ]                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
PERFORMANCE METRICS
================================================================================

Stage Detection:         < 1ms    (local algorithm)
Objective Tracking:      < 1ms    (keyword matching)
Claude API Call:         1-2s     (network + processing)
Fallback Guidance:       < 1ms    (no API call)
Total Response Time:     1-2s     (same as before)

Memory Usage:            Minimal  (no caching yet)
CPU Usage:               Low      (simple string matching)
Network Calls:           1        (only to Claude API)

================================================================================
